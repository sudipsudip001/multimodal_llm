<!DOCTYPE html>
<html>
<head>
    <title>bank customer support</title>
</head>
<body>
    <form id="chatbot">
        <input type="text" placeholder="What do you want to know?" id="query">
        <button type="submit">Ask the bot</button>
    </form>
    <div id="response"></div><br><br>

    <input type="file" id="audioInput" accept="audio/*">
    <button id="sendButton">Send Audio</button><br>
    <audio id="audioPlayback" controls></audio>

    <script>
        document.getElementById('chatbot').addEventListener('submit', function(event){
            event.preventDefault();
            const query = document.getElementById('query').value;

            fetch('/text', {
                method: 'POST',
                headers: {
                    'Content-Type' : 'application/json'
                },
                body: JSON.stringify({prompt : query})
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('response').innerHTML = `<p>${data.response}</p>`;
            })
            .catch(error => console.error('Error:', error));
        });

        //for audio
        const audioInput = document.getElementById("audioInput");
        const sendButton = document.getElementById("sendButton");
        const audioPlayback = document.getElementById("audioPlayback");

        sendButton.onclick = () => {
            if(!audioInput.files.length){
                alert('Please select an audio file first.');
                return;
            }
            const formData = new FormData();
            formData.append('audio', audioInput.files[0]);

            fetch('/audio', {
                method: 'POST',
                body: formData
            })
            .then(response =>{
                console.log('Response status:', response.status);
                if(!response.ok){
                    return response.text().then(text => { throw new Error(text)});
                }
                return response.blob();
            })
            .then(blob => {
                console.log('Received blob:', blob);
                const audioUrl = URL.createObjectURL(blob);
                audioPlayback.src = audioUrl;
                audioPlayback.play();
            })
            .catch(error => {
                console.error('Detailed error:', error);
                alert('An error occured while processing the audio: ' + error.message);
            });
        };
    </script>
</body>
</html>